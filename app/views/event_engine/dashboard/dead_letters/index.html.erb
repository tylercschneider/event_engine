<h1>Dead Letters</h1>

<nav class="dashboard-nav">
  <%= link_to "Dashboard", dashboard_root_path %> |
  <%= link_to "Events", dashboard_events_path %> |
  <%= link_to "Dead Letters", dashboard_dead_letters_path %>
</nav>

<% if @events.any? %>
  <p>
    <%= button_to "Retry All", retry_all_dashboard_dead_letters_path, method: :post, class: "btn-retry-all" %>
  </p>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Event Name</th>
        <th>Attempts</th>
        <th>Error</th>
        <th>Dead Lettered At</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @events.each do |event| %>
        <tr class="dead-letter-row">
          <td><%= event.id %></td>
          <td><%= link_to event.event_name, dashboard_event_path(event) %></td>
          <td><%= event.attempts %></td>
          <td><%= event.last_error_class %>: <%= event.last_error_message&.truncate(80) %></td>
          <td><%= event.dead_lettered_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
          <td>
            <%= button_to "Retry", retry_dashboard_dead_letter_path(event), method: :post, class: "btn-retry" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="pagination">
    <% if @page > 1 %>
      <%= link_to "Previous", dashboard_dead_letters_path(page: @page - 1) %>
    <% end %>

    <span>Page <%= @page %> of <%= @total_pages %></span>

    <% if @page < @total_pages %>
      <%= link_to "Next", dashboard_dead_letters_path(page: @page + 1) %>
    <% end %>
  </div>
<% else %>
  <p>No dead-lettered events.</p>
<% end %>
